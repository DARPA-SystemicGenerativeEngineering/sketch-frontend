static void enqueue (Queue q, Item obj) {
    Node n = newNode (obj, null, 0);
    Node oldTail = null;

    // What this is doing:
    //   oldTail = AtomicSwap ({| q.tail|n |}, {| n|q.tail |});
    atomic {
        oldTail = ?? ? q.tail : n;
        if (??)  q.tail = n;
        else     n = q.tail;
    }
    oldTail.next = n;
}
